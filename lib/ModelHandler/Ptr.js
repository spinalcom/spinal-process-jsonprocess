"use strict";

// Generated by CoffeeScript 2.3.1
(function () {
  var G_root, load_ptr_func;

  require("spinal-core-connectorjs");

  G_root = typeof window === "undefined" ? global : window;

  load_ptr_func = function load_ptr_func(ptr) {
    var target_ptr;
    target_ptr = ptr.data.value;
    if (target_ptr && typeof FileSystem._objects[target_ptr] !== 'undefined') {
      return Promise.resolve(FileSystem._objects[target_ptr]);
    }
    return new Promise(function (resolve, reject) {
      return ptr.load(function (result) {
        if (result) {
          return resolve(result);
        } else {
          return reject("Ptr load error target = " + target_ptr);
        }
      });
    });
  };

  module.exports = {
    modelType: G_root.Ptr,
    modelName: "Ptr",
    prority: 1,
    handler: function handler() {
      var _this = this;

      var _json, _model;
      _json = this._json;
      _model = this._model;
      if (this._load_ptr === true || _model.data.value !== 0) {
        return load_ptr_func(_model).then(function (m) {
          return G_root.JsonProcess._assignWithModel.call(_this, _this._json, "data", m);
        }, function (error) {
          return console.error(error);
        });
      } else {
        _json.data = {
          _server_id: _model.data.value
        };
        return Promise.resolve(_json);
      }
    }
  };
}).call(undefined);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Nb2RlbEhhbmRsZXIvUHRyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxDQUFBLFlBQUE7QUFBQSxNQUFBLE1BQUEsRUFBQSxhQUFBOztBQUFBLFVBQUEseUJBQUE7O0FBQ0EsV0FBWSxPQUFBLE1BQUEsS0FBSCxXQUFHLEdBQUgsTUFBRyxHQUE4QyxNQUExRDs7QUFFQSxrQkFBZ0IsdUJBQUEsR0FBQSxFQUFBO0FBQ2QsUUFBQSxVQUFBO0FBQUEsaUJBQWEsSUFBSSxJQUFKLENBQVMsS0FBdEI7QUFDQSxRQUFJLGNBQWMsT0FBTyxXQUFXLFFBQVgsQ0FBUCxVQUFPLENBQVAsS0FBbEIsV0FBQSxFQUFBO0FBQ0UsYUFBTyxRQUFBLE9BQUEsQ0FBZ0IsV0FBVyxRQUFYLENBRHpCLFVBQ3lCLENBQWhCLENBQVA7O0FBQ0YsV0FBTyxJQUFBLE9BQUEsQ0FBWSxVQUFBLE9BQUEsRUFBQSxNQUFBLEVBQUE7YUFDakIsSUFBQSxJQUFBLENBQVMsVUFBQSxNQUFBLEVBQUE7QUFDUCxZQUFBLE1BQUEsRUFBQTtpQkFDRSxRQURGLE1BQ0UsQztBQURGLFNBQUEsTUFBQTtpQkFHRSxvQ0FIRixVQUdFLEM7O0FBSkosT0FBQSxDO0FBREssS0FBQSxDQUFQO0FBSmMsR0FBaEI7O0FBYUEsU0FBQSxPQUFBLEdBQWlCO0FBQ2YsZUFBVyxPQURJLEdBQUE7QUFFZixlQUZlLEtBQUE7QUFHZixhQUhlLENBQUE7QUFLZixhQUFTLG1CQUFBO0FBQUE7O0FBQ1AsVUFBQSxLQUFBLEVBQUEsTUFBQTtBQUFBLGNBQVEsS0FBQyxLQUFUO0FBQ0EsZUFBUyxLQUFDLE1BQVY7QUFDQSxVQUFHLEtBQUEsU0FBQSxLQUFBLElBQUEsSUFBc0IsT0FBTyxJQUFQLENBQUEsS0FBQSxLQUF6QixDQUFBLEVBQUE7QUFDRSxlQUFPLGNBQUEsTUFBQSxFQUFBLElBQUEsQ0FDRCxVQUFBLENBQUEsRUFBQTtBQUNKLGlCQUFPLE9BQU8sV0FBUCxDQUFtQixnQkFBbkIsQ0FBQSxJQUFBLENBQUEsS0FBQSxFQUE0QyxNQUE1QyxLQUFBLEVBQUEsTUFBQSxFQUFBLENBQUEsQ0FBUDtBQUZLLFNBQUEsRUFHTCxVQUFBLEtBQUEsRUFBQTtpQkFBVyxRQUFBLEtBQUEsQ0FBQSxLQUFBLEM7QUFKZixTQUNTLENBQVA7QUFERixPQUFBLE1BQUE7QUFNRSxjQUFBLElBQUEsR0FBYTtBQUNULHNCQUFZLE9BQU8sSUFBUCxDQUFZO0FBRGYsU0FBYjtBQUdBLGVBQU8sUUFBQSxPQUFBLENBVFQsS0FTUyxDQUFQOztBQVpLO0FBTE0sR0FBakI7Q0FoQkEsRSxJQUFBIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZShcInNwaW5hbC1jb3JlLWNvbm5lY3RvcmpzXCIpXG5HX3Jvb3QgPSBpZiB0eXBlb2Ygd2luZG93ID09IFwidW5kZWZpbmVkXCIgdGhlbiBnbG9iYWwgZWxzZSB3aW5kb3dcblxubG9hZF9wdHJfZnVuYyA9IChwdHIpIC0+XG4gIHRhcmdldF9wdHIgPSBwdHIuZGF0YS52YWx1ZVxuICBpZiAodGFyZ2V0X3B0ciAmJiB0eXBlb2YgRmlsZVN5c3RlbS5fb2JqZWN0c1t0YXJnZXRfcHRyXSAhPSAndW5kZWZpbmVkJylcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKEZpbGVTeXN0ZW0uX29iamVjdHNbdGFyZ2V0X3B0cl0pXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSAtPlxuICAgIHB0ci5sb2FkKChyZXN1bHQpIC0+XG4gICAgICBpZiAocmVzdWx0KVxuICAgICAgICByZXNvbHZlKHJlc3VsdClcbiAgICAgIGVsc2VcbiAgICAgICAgcmVqZWN0KFwiUHRyIGxvYWQgZXJyb3IgdGFyZ2V0ID0gI3t0YXJnZXRfcHRyfVwiKVxuICAgIClcbiAgKVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgbW9kZWxUeXBlOiBHX3Jvb3QuUHRyLFxuICBtb2RlbE5hbWU6IFwiUHRyXCIsXG4gIHByb3JpdHk6IDFcblxuICBoYW5kbGVyOiAoKSAtPlxuICAgIF9qc29uID0gQF9qc29uXG4gICAgX21vZGVsID0gQF9tb2RlbFxuICAgIGlmIEBfbG9hZF9wdHIgPT0gdHJ1ZSB8fCBfbW9kZWwuZGF0YS52YWx1ZSAhPSAwXG4gICAgICByZXR1cm4gbG9hZF9wdHJfZnVuYyhfbW9kZWwpXG4gICAgICAudGhlbigobSkgPT5cbiAgICAgICAgcmV0dXJuIEdfcm9vdC5Kc29uUHJvY2Vzcy5fYXNzaWduV2l0aE1vZGVsLmNhbGwoQCwgQF9qc29uLCBcImRhdGFcIiwgbSlcbiAgICAgICwgKGVycm9yKSAtPiBjb25zb2xlLmVycm9yIGVycm9yKVxuICAgIGVsc2VcbiAgICAgIF9qc29uLmRhdGEgPSB7XG4gICAgICAgICAgX3NlcnZlcl9pZDogX21vZGVsLmRhdGEudmFsdWVcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoX2pzb24pXG5cbn0iXSwic291cmNlUm9vdCI6Ii4uLy4uIn0=
//# sourceURL=/home/laurent/share_to_send/modules/spinal-process-jsonprocess/src/ModelHandler/Ptr.coffee