"use strict";

// Generated by CoffeeScript 2.3.1
(function () {
  var G_root;

  require("spinal-core-connectorjs");

  G_root = typeof window === "undefined" ? global : window;

  module.exports = {
    modelType: G_root.Ptr,
    modelName: "Ptr",
    prority: 1,
    handler: function handler() {
      var _this = this;

      var _json, _model;
      _json = this._json;
      _model = this._model;
      if (this._load_ptr === true) {
        if (_model.data.value === 0) {
          return Promise.reject();
        }
        return new Promise(function (resolve, reject) {
          return _model.load(function (ptr) {
            if (ptr) {
              return resolve(ptr);
            } else {
              return reject("Load error: " + _model._server_id);
            }
          });
        }).then(function (m) {
          return G_root.JsonProcess._assignWithModel.call(_this, _this._json, "data", m);
        }, function (error) {
          return console.error(error);
        });
      } else {
        _json.data = {
          _server_id: _model.data.value
        };
        return Promise.resolve(_json);
      }
    }
  };
}).call(undefined);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Nb2RlbEhhbmRsZXIvUHRyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxDQUFBLFlBQUE7QUFBQSxNQUFBLE1BQUE7O0FBQUEsVUFBQSx5QkFBQTs7QUFDQSxXQUFZLE9BQUEsTUFBQSxLQUFILFdBQUcsR0FBSCxNQUFHLEdBQThDLE1BQTFEOztBQUVBLFNBQUEsT0FBQSxHQUFpQjtBQUNmLGVBQVcsT0FESSxHQUFBO0FBRWYsZUFGZSxLQUFBO0FBR2YsYUFIZSxDQUFBO0FBS2YsYUFBUyxtQkFBQTtBQUFBOztBQUNQLFVBQUEsS0FBQSxFQUFBLE1BQUE7QUFBQSxjQUFRLEtBQUMsS0FBVDtBQUNBLGVBQVMsS0FBQyxNQUFWO0FBQ0EsVUFBRyxLQUFBLFNBQUEsS0FBSCxJQUFBLEVBQUE7QUFDRSxZQUFJLE9BQU8sSUFBUCxDQUFBLEtBQUEsS0FBSixDQUFBLEVBQUE7QUFDRSxpQkFBTyxRQURULE1BQ1MsRUFBUDs7QUFDRixlQUFTLElBQUEsT0FBQSxDQUFZLFVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQTtpQkFDbkIsT0FBQSxJQUFBLENBQVksVUFBQSxHQUFBLEVBQUE7QUFDVixnQkFBQSxHQUFBLEVBQUE7cUJBQ0UsUUFERixHQUNFLEM7QUFERixhQUFBLE1BQUE7cUJBR0UsT0FBTyxpQkFBaUIsT0FIMUIsVUFHRSxDOztBQUpKLFdBQUEsQztBQURNLFNBQUMsQ0FBRCxDQUFBLElBQUEsQ0FRRixVQUFBLENBQUEsRUFBQTtBQUNKLGlCQUFPLE9BQU8sV0FBUCxDQUFtQixnQkFBbkIsQ0FBQSxJQUFBLENBQUEsS0FBQSxFQUE0QyxNQUE1QyxLQUFBLEVBQUEsTUFBQSxFQUFBLENBQUEsQ0FBUDtBQVRNLFNBQUEsRUFVTixVQUFBLEtBQUEsRUFBQTtpQkFBVyxRQUFBLEtBQUEsQ0FBQSxLQUFBLEM7QUFiZixTQUdVLENBQVI7QUFIRixPQUFBLE1BQUE7QUFlRSxjQUFBLElBQUEsR0FBYTtBQUNULHNCQUFZLE9BQU8sSUFBUCxDQUFZO0FBRGYsU0FBYjtBQUdBLGVBQU8sUUFBQSxPQUFBLENBbEJULEtBa0JTLENBQVA7O0FBckJLO0FBTE0sR0FBakI7Q0FIQSxFLElBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKFwic3BpbmFsLWNvcmUtY29ubmVjdG9yanNcIilcbkdfcm9vdCA9IGlmIHR5cGVvZiB3aW5kb3cgPT0gXCJ1bmRlZmluZWRcIiB0aGVuIGdsb2JhbCBlbHNlIHdpbmRvd1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgbW9kZWxUeXBlOiBHX3Jvb3QuUHRyLFxuICBtb2RlbE5hbWU6IFwiUHRyXCIsXG4gIHByb3JpdHk6IDFcblxuICBoYW5kbGVyOiAoKSAtPlxuICAgIF9qc29uID0gQF9qc29uXG4gICAgX21vZGVsID0gQF9tb2RlbFxuICAgIGlmIEBfbG9hZF9wdHIgPT0gdHJ1ZVxuICAgICAgaWYgKF9tb2RlbC5kYXRhLnZhbHVlID09IDApXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgpXG4gICAgICByZXR1cm4gKChuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSAtPlxuICAgICAgICBfbW9kZWwubG9hZCgocHRyKSAtPlxuICAgICAgICAgIGlmIHB0clxuICAgICAgICAgICAgcmVzb2x2ZShwdHIpXG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmVqZWN0KFwiTG9hZCBlcnJvcjogXCIgKyBfbW9kZWwuX3NlcnZlcl9pZClcbiAgICAgICAgKVxuICAgICAgKSlcbiAgICAgIC50aGVuKChtKSA9PlxuICAgICAgICByZXR1cm4gR19yb290Lkpzb25Qcm9jZXNzLl9hc3NpZ25XaXRoTW9kZWwuY2FsbChALCBAX2pzb24sIFwiZGF0YVwiLCBtKVxuICAgICAgLCAoZXJyb3IpIC0+IGNvbnNvbGUuZXJyb3IgZXJyb3IpKVxuICAgIGVsc2VcbiAgICAgIF9qc29uLmRhdGEgPSB7XG4gICAgICAgICAgX3NlcnZlcl9pZDogX21vZGVsLmRhdGEudmFsdWVcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoX2pzb24pXG59Il0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
//# sourceURL=/home/laurent/share_to_send/modules/spinal-process-jsonprocess/src/ModelHandler/Ptr.coffee